## Abstract

我们提出了一种在Gephi软件中实现的力导向算法ForceAtlas2。它的目的是给网络一个可读的形状(空间化)。我们并没有声称这是一个理论上的进步，但是我们尝试着整合不同的技术，比如Barnes Hut的模拟，度相关的斥力，局部和全局的自适应温度。该算法利用了大量的反馈信息，为用户提供了丰富的体验。我们为需要精确理解其行为的用户公开其完整功能。我们提出了一个我们在性能和质量之间妥协的基准，并讨论了我们为什么要集成它的不同特性


## I. INTRODUCTION

本文针对两种不同的公众。对于Gephi用户，我们提出了ForceAtlas2算法及其设置的完整描述。对于对空间化算法的发展感兴趣的研究人员或工程师，我们建议讨论我们对特征和实现的选择。如果开发一个算法是“研究”，实现它是“工程”，那么Gephi的一个特性通常来自工程而不是研究。这就是为什么它看起来与Pajek这样的软件如此不同。这也是为什么ForceAtlas2更注重可用性而不是独创性的原因。我们对网络空间化数学的贡献仅限于自适应速度(步长选择)的特定实现的基准。本文更侧重于从丰富用户体验的角度来分析经典技术是如何组合在一起的，以及哪些技术不是。我们需要快速解释用户反馈如何将我们引向forceatlas2(一个连续算法)的特定方向。我们将展示在这个布局中收集的不同技术，使用一些正式语言和许多插图。我们将通过示例和基准来讨论步骤长度选择的实现。最后对算法的总体设计进行了简要的讨论。

## II.  AWILD NETWORK  VISUALIZATION TOOL APPEARS

2008年，我们开始在巴黎人类之家(Maison des Sciences de l 'Homme)开发Gephi[1]，这是一款可视化和操纵网络的软件，由达纳·迪米内斯库(Dana Diminescu[2])负责开发。我们的目标是为社会科学家提供一些网络分析方法，而不是让他们学习图论。三个参考软件启发了我们:Pajek(需要引用)，GUESS(需要引用)和TouchGraph(需要引用)。TouchGraph提供了一个我们喜欢的可操作的界面，但是它有很强的性能问题，而且布局不适合100个或更多节点的无标度网络(高度的视觉混乱)。Pajek非常强大，但不适合动态探索(它是作为计算软件设计的，可视化是额外的好处)。GUESS最适合我们的需求，以用户为中心，实现了GEM(需要引用)等最先进的空间化算法。我们在这里不解释我们创建Gephi而不是仅仅使用GUESS的原因，因为这是一个更大的讨论。但这篇论文的一个重要观点是，我们想要一个连贯的布局，一个运行良好的布局，一个可以显示的布局。可视化的“生活”空间化是Gephi的一个关键特征，并得到了广泛的赞赏。它提供了对布局过程及其设置的非常直观的理解。它允许用户尝试错误的布局方法，这改善了Gephi的收益曲线。我们结合现有技术开发了ForceAtlas2。我们做得很疯狂。我们不是从对学术论文的系统回顾开始，而是最终重新开发了现有的技术。当用户需要特性时，我们就实现它们，并且在settings1的设计中尽量做到用户友好。我们将ForceAtlas2的重点放在流畅性和质量上，因为流畅性是Gephi操作用户体验所要求的，而且研究人员更喜欢高质量的性能。该算法的基础并不复杂。只要它运行，诺德斯排斥和边缘吸引。这种简单性的吸引力来自于对透明性的需求。社会科学家不承认黑匣子，我们也不承认。我们的特性改变了力或者它们是如何被模拟的，但是保持这种连续力定向布局的模型:只要布局在运行，力就会持续应用。在本文的最后，我们给出了更多的原因。开发一个连续的算法使我们无法实现许多强大的技术。这里我们来看看一些我们为了集中注意力而故意避免的技巧。模拟退火(需要引用)不能完全实现，任何自动停止功能(如YifanHu[9]，也在Gephi中实现)也不能完全实现。我们的布局只在用户请求时停止。例如，OpenOrd[8]使用的Phasedstrategies从定义上来说是不兼容的，即使在这种情况下，它允许OpenOrd对更大的网络进行空间化。由于同样的原因，图形粗化(需要引用)无法实现。节点起始位置(需要引用)的经典优化也会打破连续性。最后，如果力量的应用不一致，策略也不适合。值得注意的是，旧的Kamada Kawai(需要引用)和最近的GEM(需要引用)的情况就是如此。我们放弃了许多技术，继续使用原力。但大多数这些实际上是优化，我们的性能仍然与Gephi管理的网络大小一致(我们将看到)。我们能够实现影响节点位置的定性特征，如Noack(引文需要)、万有引力(引文需要)等提出的依赖于程度的斥力。我们还实现了Noack[6]提出的Lin-Log力量，这对我们是一个很大的启发，因为他的布局质量的概念符合研究人员的需要(模块化的可视化解释)

## III.  ANATOMY  OFFORCEATLAS2

ForceAtlas2是一种面向力的布局:它模拟一个物理系统，以便将一个网络空间化。节点像磁铁一样相互排斥，而边缘像弹簧一样吸引节点。这些力量创造了一种向平衡状态收敛的运动。希望最后的配置有助于解释数据。力向图具有放置其他节点功能的特殊性。这个过程只依赖于节点之间的连接。没有考虑节点的最终属性。这种策略有缺点。结果随初始状态的不同而变化。这个过程是不确定的，每个点的坐标不反映任何特定的变量。结果不能被解读为笛卡尔投影。你不能单独解释一个节点的位置，你必须将它与其他节点进行比较。尽管存在这个问题，该技术的优势是允许对结构进行可视化解释。它的本质是将结构代理转化为视觉代理，促进对社交网络的分析，尤其是对社交网络的分析。Noack[3]已经表明这些proxi表达了社区2。其他类型的布局允许对结构进行可视化解释，比如确定性可视化XXX(需要引用)，但是它们没有显示结构的模块化方面。

#### A. Energy Model

每一种力定向算法都依赖于引力的某个公式和斥力的某个公式。“spring-electric”布局[10]是受到现实生活启发的模拟。它利用带电粒子的斥力公式(Fr=k=d2)和弹簧的引力公式(Fa=k:d)，涉及两个节点之间的几何距离。Fruchterman和Rheingold[7]利用自定义力(attractionFa=d2=kand resisionfr =k2=d，通过调整网络的比例)创建了一个有效的算法。16年后，Noack[6]解释道，力定向算法之间最重要的区别在于距离在图空间化中的作用。在物理系统中，力取决于相互作用的实体之间的距离:较近的实体比较远的实体吸引较少的斥力，反之亦然。距离和力之间的关系可以是线性的、指数的或对数的。例如，弹簧模型精确地复制了它所受到的物理力，从而建立了距离和力之间的线性比例关系(关于弹簧引力)，以及距离和力之间的平方比例关系(关于电磁斥力)。Noack将布局的能量模型或“(引力，斥力)-模型”定义为用来计算引力和斥力的公式中距离的指数(0次幂)。例如，弹簧电动布局模型为(1;2)。ForceAtlas(1;1)的(引力、斥力)-模型位于noack’s LinLog(0;1)和Fruchterman、Rheingold(2;1)算法之间的中间位置。

Noack[3]说“对于大的边，距离不太依赖于密度，对于小的边，距离不太依赖于路径长度”(“密度”是实际边与潜在边的比率)。这意味着视觉簇表示结构密度较低时，即引力对距离的依赖程度较低时，以及斥力对距离的依赖程度较高时。ForceAtlas2显示集群的能力比Fruchterman和Rheingold的算法要好，比LinLog的算法差(图1)。

1)经典引力:两个连通节点之间的引力1和2没有什么不同。它线性地依赖于距离(n1;n2)稍后我们将解释为什么没有不断调整这个力

Fa(n1, n2) = d(n1, n2)  (1)

2)程度排斥:ForceAtlas2的一个典型用例是社交网络。这种网络的一个共同特征是存在许多“叶子”(只有一个邻居的节点)。这是由于许多真实世界数据的度的幂律分布。围绕着几个高度连接的节点的“叶子”森林是视觉混乱的主要来源之一。我们考虑了斥力中节点的程度，从而减少了这种特殊的视觉混乱。这样做的目的是让连接不良的节点更接近连接良好的节点。我们的解决方案是调整排斥力，这样连得不好的节点和连得很好的节点的排斥就会减少。我们的斥力与两个节点的度数加1 (deg+ 1)的乘积成正比。系数由设置定义。

公式

这个公式非常类似于Noack[6]提出的边缘斥力，只不过他使用的是度而不是度+ 1。+1很重要，因为它确保即使节点的度为零，仍然有一些斥力。我们推测这个特征对结果和可读性的影响比(吸引，排斥)模型更大。

#### B. Settings

我们现在详细介绍向用户建议的设置、它们实现了什么以及它们对布局的影响。大多数这些设置允许用户影响节点的位置(网络的形状)。它们允许用户从新的角度看待数据和/或解决特定的问题。可以在布局运行时激活它们，从而让用户看到它们如何影响空间化。


1) LinLog模式:Andreas Noack在放置质量测量方面做得很好(引用需要)。它的LinLog energy模型可以说提供了最易读的位置，因为它的位置符合Newman的模块化(需要引用)，这是一种广泛使用的社区结构度量。LinLog模式只使用对数引力。

公式（3）

这个公式与Noack的公式不同，因为我们将1添加到管理断开节点的程度(log(0)将产生一个错误)。我们已经看到，这个能量模型对图形的形状有很强的影响，使得星系团更加紧密(图1)，我们还观察到它在某些情况下收敛缓慢。从常规模式切换到LinLog模式需要调整的是缩放参数。

2)重力:重力是强制布局的常见改进。这个力Fg(n)防止断开的组件(孤岛)漂移。它将节点吸引到空间化空间的中心。它的主要目的是补偿远离中心的节点的斥力。在我们的例子中，它需要像排斥力那样加权:

公式（4）

kg is set by the user.

“强引力”选项设置一个力，吸引更多远离中心的节点(d(n)是这个距离)。这种力量的缺点是过于强大，有时甚至比其他力量还要强大。这可能会导致节点的位置有偏差。但是它的优点是强制执行非常紧凑的布局，这对于某些用途可能是有用的。

公式（5）

3)缩放:一个力向布局可能包含两个常量ka和kr，它们在图形的空间化中起着相反的作用。引力常数ka调节引力，kr调节斥力。增加ka会减小图的大小，而增加kr会使图变大。在ForceAtlas的第一个版本中，用户可以修改这两个变量的值。但是，出于实际目的，最好只有一个缩放参数。在ForceAtlas2中，缩放是kr，而不存在ka。kr越高，图像越大。

4)边缘权值:若对边缘进行加权，则在计算引力时考虑该权值。如果设置“边缘权重影响”为0，则忽略权重。如果它被设为1，那么吸引力与重量成正比。大于1的值强调权重的影响。该参数用于根据边缘e的权值w(e)修改引力:

公式（6）

5)劝阻集线器:ForceAtlas2有一个“劝阻集线器”模式，一旦激活，通过将每个节点的吸引力除以其指向的节点的度加1来影响图形的形状。主动时，引力计算如下:

公式（7）

此模式的目的是授予权限(具有高学位的节点)比中心(具有高学位的节点)更集中的位置4。这对于社交网络和web网络很有用，在这些网络中，权威有时被认为比中心更重要。“劝阻集线器”倾向于将集线器推到外围，同时保持中心的权威。

6)防止重叠:在此模式下，斥力被修改，使节点不重叠。这个想法是考虑节点的大小(n)在计算距离(n1;n2)在引力和斥力。

这个想法是考虑节点的大小(n)在计算距离(n1;n2)在引力和斥力。

这部分主要问题是size（n）没写怎么定义的。

然后就是写怎么防止重叠

在Gephi的实现中，k0r被任意设置为100。请注意，由于这个选项，摆动测量是有偏差的，这就是为什么我们还实现了本地速度的一个递减因子(除以10)。需要注意的是，这种模式在收敛运动中增加了相当大的摩擦力，减缓了空间化性能。只有在图空间化收敛后才有必要应用它。


7)近似斥力:为了提高大图的空间化性能，我们对Barnes Hut[13]进行了优化。依靠排斥力的近似计算，这种优化会产生近似结果，在小网络上可能产生反效果，因此我们允许用户禁用它。除了近似的副作用外，它不会影响布局的形状。没有Barnes和Hut优化，复杂度时间为o(n2)，其中n为节点数。


## IV.  PERFORMANCE OPTIMIZATION

#### A. The issue of speed

当使用基于力量的布局时，用户必须处理速度/精度的权衡。这个问题是使用力模拟的结果。它出现在任何力定向算法以及其他类型的模拟中。时间在模拟中不是连续的，因为它是一步一步计算出来的。如果您使用许多计算步骤，您将得到一个精确的模拟，但是需要更长的时间来计算:它很慢。如果你选择很少的步骤，它被快速计算，但模拟是不精确的。减少步数是对系统的粗略估计。讨论这个问题的恰当术语应该是“步长”，因为它是我们实际使用的数学变量。但是我们更喜欢这里的术语“速度”，因为它更接近用户的体验。仿真的速度就像步长一样:高速意味着步长(精度较低)，低速意味着步长(精度较高)。在力定向算法中，速度的增加会使精度下降。我们不能同时拥有速度和精度。这种近似的结果是，一些节点无法找到一个稳定的位置，开始在平衡位置附近振荡(图7)。


这种振荡问题被称为“温度”问题，因为我们可以将节点的运动模拟成分子的温度。存在不同的解决方案:GEM中所描述的局部温度(引文需要)，Yifan胡[9]中所描述的自适应冷却或者模拟退火(引文需要)。ForceAtlas2的特点是它自己实现了本地温度和自适应冷却，但是是在连续布局的角度。在“速度与精度”方面，由于用户更熟悉这些概念，我们为每个节点以及整个图计算一个最佳速度。我们的策略是测量振荡并计算只允许一定振荡的速度。这个数量由用户设置为“容忍(速度)”。在Gephi的实现中，我们设置了三个默认值:5000个节点以下0.1个，1个到50000个节点，以及10个以上。现在我们来描述这个特性是如何工作的。

B. Adapting the local speed

我们实施了一种旨在优化收敛性的策略。研究人员经常想象一些节点聚集大量边缘的无标度网络。高连接节点的温度很高。它们往往振荡很快，需要高精度，因此速度较慢。连接不良的节点非常稳定，因此可以高速运行。如果我们对不同的节点有不同的速度，我们可以获得更好的性能。


我们的策略是通过观察每个节点的振荡来确定其速度，就像GEM[?]一样。但是我们的实现是完全不同的。我们的振荡版本是基于施加在每个节点上的力，我们称之为“摆动”(振荡是关于距离的)。我们将节点n的摆动swg(n)定义为在给定步骤作用于n的力与在前一步作用于n的力之间的散度。直观地说，节点被要求改变的方向越多，它在第t步作用于n上的力的摆动就越大。



---

力导图模型

- 弹簧布局
  - 引力 弹簧力 Fa = -kd
  - 斥力 带电粒子的斥力 Fr = k/d^2
  - d是两点间的距离
- Fruchterman and Rheingold创建了自定义的力
  - 引力 Fa = d^2/k
  - 斥力 Fr = -k^2/d
  - k由网络自己调整
- fa2
  - 引力 经典的引力，依赖于距离
  - 斥力 与节点的度成正比，目的是让邻居较少的节点更接近邻居多的节点，邻居较多的节点相互远离，以减少视觉上的混乱。特别的地方是 deg+1


---

我的改进

- 减少有相连的节点间的距离
- 设置中心点？
-
